<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Nginx Proxy Manager API ( openai ) - d4nc1ntr33</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="preload" href="https://d4nc1ntr33.funkysys.org/assets/dynamic/fonts/publicsans/publicsans.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://d4nc1ntr33.funkysys.org/assets/css/style.css?v=0e21f761d0bfa96fcac910b371493717"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://d4nc1ntr33.funkysys.org/nginx-proxy-manager-api-openai/"},"headline":"Nginx Proxy Manager API ( openai )","datePublished":"2024-07-24T01:47+02:00","dateModified":"2024-07-25T02:34+02:00","description":"Question: can you make an overall guide for all the endpoints of&hellip;","author":{"@type":"Person","name":"d4nc1ntr33","url":"https://d4nc1ntr33.funkysys.org/authors/dario/"},"publisher":{"@type":"Organization","name":"d4nc1ntr33"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="content"><div class="left-bar"><div class="left-bar__inner"><header class="header"><a class="logo" href="https://d4nc1ntr33.funkysys.org/">d4nc1ntr33</a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle__box"><span class="navbar__toggle__inner">Menu</span></span></button><ul class="navbar__menu"><li><a class="tltp" href="https://d4nc1ntr33.funkysys.org/tags/" target="_self" aria-label="Notes">Notes <span>Notes</span></a></li><li><a href="https://d4nc1ntr33.funkysys.org/tags/" target="_self" aria-label="Bookmarks"><span>Bookmarks</span></a></li></ul></nav><a class="logo logo--atbottom" href="./">d4nc1ntr33</a></header></div></div><main class="main"><article class="post"><div class="main__inner"><div class="post__meta"><div class="post__author"><div><a href="https://d4nc1ntr33.funkysys.org/authors/dario/" class="post__author__name">d4nc1ntr33</a></div></div><div class="post__date"><time datetime="2024-07-24T01:47">Jul 24, 2024</time></div></div><header class="post__header"><h1 class="post__title">Nginx Proxy Manager API ( openai )</h1></header><div class="post__entry"><p><strong>Question:</strong><br><em>can you make an overall guide for all the endpoints of the forementioned API with schema here https://github.com/NginxProxyManager/nginx-proxy-manager/tree/develop/backend/schema ?</em><br><br><strong>ChatGPT Reply:</strong></p><p>Sure, here's an overall guide for using the endpoints of the Nginx Proxy Manager API with the schemas provided in the repository. This guide will cover the primary endpoints listed in the schema directory and demonstrate how to interact with them using `curl`.<br><br>### Nginx Proxy Manager API Overview<br><br>The Nginx Proxy Manager API allows for managing various components such as proxy hosts, redirection hosts, and streams. The endpoints typically follow the pattern `/api/nginx/&lt;resource&gt;`. Below are examples for key endpoints with their corresponding `curl` commands for common actions: create (POST), retrieve (GET), update (PUT), and delete (DELETE).<br><br>### Endpoints<br><br>1. **Proxy Hosts**<br>2. **Redirection Hosts**<br>3. **Streams**<br>4. **Access Lists**<br>5. **Certificates**<br><br>### 1. Proxy Hosts<br><br>#### Create Proxy Host (POST)<br>```sh<br>curl -X POST http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/proxy-hosts \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "domain_names": ["example.com"],<br>Â  Â  Â  Â  Â  Â "forward_scheme": "http",<br>Â  Â  Â  Â  Â  Â "forward_host": "forwarded.example.com",<br>Â  Â  Â  Â  Â  Â "forward_port": 80,<br>Â  Â  Â  Â  Â  Â "access_list_id": 0,<br>Â  Â  Â  Â  Â  Â "certificate_id": 0,<br>Â  Â  Â  Â  Â  Â "ssl_forced": false,<br>Â  Â  Â  Â  Â  Â "caching_enabled": false,<br>Â  Â  Â  Â  Â  Â "block_exploits": false,<br>Â  Â  Â  Â  Â  Â "advanced_config": "",<br>Â  Â  Â  Â  Â  Â "meta": {<br>Â  Â  Â  Â  Â  Â  Â "letsencrypt_email": "email@example.com",<br>Â  Â  Â  Â  Â  Â  Â "letsencrypt_agree": true,<br>Â  Â  Â  Â  Â  Â  Â "dns_challenge": false<br>Â  Â  Â  Â  Â  Â }<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Retrieve Proxy Host (GET)<br>```sh<br>curl -X GET http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/proxy-hosts/&lt;id&gt;<br>```<br><br>#### Update Proxy Host (PUT)<br>```sh<br>curl -X PUT http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/proxy-hosts/&lt;id&gt; \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "domain_names": ["example.com"],<br>Â  Â  Â  Â  Â  Â "forward_scheme": "http",<br>Â  Â  Â  Â  Â  Â "forward_host": "forwarded.example.com",<br>Â  Â  Â  Â  Â  Â "forward_port": 80,<br>Â  Â  Â  Â  Â  Â "access_list_id": 0,<br>Â  Â  Â  Â  Â  Â "certificate_id": 0,<br>Â  Â  Â  Â  Â  Â "ssl_forced": false,<br>Â  Â  Â  Â  Â  Â "caching_enabled": false,<br>Â  Â  Â  Â  Â  Â "block_exploits": false,<br>Â  Â  Â  Â  Â  Â "advanced_config": "",<br>Â  Â  Â  Â  Â  Â "meta": {<br>Â  Â  Â  Â  Â  Â  Â "letsencrypt_email": "email@example.com",<br>Â  Â  Â  Â  Â  Â  Â "letsencrypt_agree": true,<br>Â  Â  Â  Â  Â  Â  Â "dns_challenge": false<br>Â  Â  Â  Â  Â  Â }<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Delete Proxy Host (DELETE)<br>```sh<br>curl -X DELETE http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/proxy-hosts/&lt;id&gt;<br>```<br><br>### 2. Redirection Hosts<br><br>#### Create Redirection Host (POST)<br>```sh<br>curl -X POST http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/redirection-hosts \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "domain_names": ["example.com"],<br>Â  Â  Â  Â  Â  Â "forward_scheme": "http",<br>Â  Â  Â  Â  Â  Â "forward_host": "forwarded.example.com",<br>Â  Â  Â  Â  Â  Â "forward_port": 80,<br>Â  Â  Â  Â  Â  Â "block_exploits": false,<br>Â  Â  Â  Â  Â  Â "caching_enabled": false,<br>Â  Â  Â  Â  Â  Â "ssl_forced": false<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Retrieve Redirection Host (GET)<br>```sh<br>curl -X GET http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/redirection-hosts/&lt;id&gt;<br>```<br><br>#### Update Redirection Host (PUT)<br>```sh<br>curl -X PUT http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/redirection-hosts/&lt;id&gt; \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "domain_names": ["example.com"],<br>Â  Â  Â  Â  Â  Â "forward_scheme": "http",<br>Â  Â  Â  Â  Â  Â "forward_host": "forwarded.example.com",<br>Â  Â  Â  Â  Â  Â "forward_port": 80,<br>Â  Â  Â  Â  Â  Â "block_exploits": false,<br>Â  Â  Â  Â  Â  Â "caching_enabled": false,<br>Â  Â  Â  Â  Â  Â "ssl_forced": false<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Delete Redirection Host (DELETE)<br>```sh<br>curl -X DELETE http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/redirection-hosts/&lt;id&gt;<br>```<br><br>### 3. Streams<br><br>#### Create Stream (POST)<br>```sh<br>curl -X POST http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/streams \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "incoming_port": 1234,<br>Â  Â  Â  Â  Â  Â "forward_scheme": "http",<br>Â  Â  Â  Â  Â  Â "forward_host": "forwarded.example.com",<br>Â  Â  Â  Â  Â  Â "forward_port": 80,<br>Â  Â  Â  Â  Â  Â "block_exploits": false,<br>Â  Â  Â  Â  Â  Â "caching_enabled": false,<br>Â  Â  Â  Â  Â  Â "ssl_forced": false<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Retrieve Stream (GET)<br>```sh<br>curl -X GET http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/streams/&lt;id&gt;<br>```<br><br>#### Update Stream (PUT)<br>```sh<br>curl -X PUT http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/streams/&lt;id&gt; \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "incoming_port": 1234,<br>Â  Â  Â  Â  Â  Â "forward_scheme": "http",<br>Â  Â  Â  Â  Â  Â "forward_host": "forwarded.example.com",<br>Â  Â  Â  Â  Â  Â "forward_port": 80,<br>Â  Â  Â  Â  Â  Â "block_exploits": false,<br>Â  Â  Â  Â  Â  Â "caching_enabled": false,<br>Â  Â  Â  Â  Â  Â "ssl_forced": false<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Delete Stream (DELETE)<br>```sh<br>curl -X DELETE http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/streams/&lt;id&gt;<br>```<br><br>### 4. Access Lists<br><br>#### Create Access List (POST)<br>```sh<br>curl -X POST http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/access-lists \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "name": "My Access List",<br>Â  Â  Â  Â  Â  Â "satisfy_any": false,<br>Â  Â  Â  Â  Â  Â "items": [<br>Â  Â  Â  Â  Â  Â  Â {<br>Â  Â  Â  Â  Â  Â  Â  Â "address": "192.168.1.1",<br>Â  Â  Â  Â  Â  Â  Â  Â "directive": "allow"<br>Â  Â  Â  Â  Â  Â  Â }<br>Â  Â  Â  Â  Â  Â ]<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Retrieve Access List (GET)<br>```sh<br>curl -X GET http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/access-lists/&lt;id&gt;<br>```<br><br>#### Update Access List (PUT)<br>```sh<br>curl -X PUT http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/access-lists/&lt;id&gt; \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "name": "My Access List",<br>Â  Â  Â  Â  Â  Â "satisfy_any": false,<br>Â  Â  Â  Â  Â  Â "items": [<br>Â  Â  Â  Â  Â  Â  Â {<br>Â  Â  Â  Â  Â  Â  Â  Â "address": "192.168.1.1",<br>Â  Â  Â  Â  Â  Â  Â  Â "directive": "allow"<br>Â  Â  Â  Â  Â  Â  Â }<br>Â  Â  Â  Â  Â  Â ]<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Delete Access List (DELETE)<br>```sh<br>curl -X DELETE http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/access-lists/&lt;id&gt;<br>```<br><br>### 5. Certificates<br><br>#### Create Certificate (POST)<br>```sh<br>curl -X POST http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/certificates \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "provider": "letsencrypt",<br>Â  Â  Â  Â  Â  Â "domain_names": ["example.com"],<br>Â  Â  Â  Â  Â  Â "letsencrypt_email": "email@example.com",<br>Â  Â  Â  Â  Â  Â "letsencrypt_agree": true,<br>Â  Â  Â  Â  Â  Â "dns_provider": null,<br>Â  Â  Â  Â  Â  Â "dns_provider_data": null,<br>Â  Â  Â  Â  Â  Â "meta": {}<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Retrieve Certificate (GET)<br>```sh<br>curl -X GET http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/certificates/&lt;id&gt;<br>```<br><br>#### Update Certificate (PUT)<br>```sh<br>curl -X PUT http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/certificates/&lt;id&gt; \<br>Â  Â  Â -H "Content-Type: application/json" \<br>Â  Â  Â -d '{<br>Â  Â  Â  Â  Â  Â "provider": "letsencrypt",<br>Â  Â  Â  Â  Â  Â "domain_names": ["example.com"],<br>Â  Â  Â  Â  Â  Â "letsencrypt_email": "email@example.com",<br>Â  Â  Â  Â  Â  Â "letsencrypt_agree": true,<br>Â  Â  Â  Â  Â  Â "dns_provider": null,<br>Â  Â  Â  Â  Â  Â "dns_provider_data": null,<br>Â  Â  Â  Â  Â  Â "meta": {}<br>Â  Â  Â  Â  Â }'<br>```<br><br>#### Delete Certificate (DELETE)<br>```sh<br>curl -X DELETE http://&lt;NGINX_PROXY_MANAGER_API_URL&gt;/api/nginx/certificates/&lt;id&gt;<br>```<br><br>### Authentication<br>If authentication is required, you should include the appropriate headers for your authentication method (e.g., Bearer token):<br><br>```sh<br>-H "Authorization: Bearer &lt;YOUR_API_TOKEN&gt;"<br>```<br><br>### Notes<br>- Replace `&lt;NGINX_PROXY_MANAGER_API_URL&gt;` with the actual URL of your Nginx Proxy Manager API.<br>- Replace `&lt;id&gt;` with the actual ID of the resource you're interacting with.<br>- Customize the JSON payloads as per your needs.<br><br>This guide should help you interact with the Nginx Proxy Manager API using `curl` for the most common operations.</p></div><footer class="post__footer"><div class="post__last-updated">This article was updated on <time datetime="2024-07-25T02:34">Jul 25, 2024</time></div><div class="post__share"></div></footer></div></article><div class="post__section post__related"><div class="main__inner"><h3 class="post__section__title">Related post</h3><div class="post__related__wrap"><article class="c-card"><div class="c-card__meta"><div class="c-card__author"><a href="https://d4nc1ntr33.funkysys.org/authors/dario/">d4nc1ntr33</a></div><time datetime="2022-12-30T00:38">Dec 30, 2022</time></div><header class="c-card__header"><h2 class="c-card__title"><a href="https://d4nc1ntr33.funkysys.org/nginx-conditional-proxy_pass/">Nginx conditional proxy_pass</a></h2><p>in case you need to conditionally change proxy settings based on the presence of a file</p></header></article><article class="c-card"><div class="c-card__meta"><div class="c-card__author"><a href="https://d4nc1ntr33.funkysys.org/authors/dario/">d4nc1ntr33</a></div><time datetime="2022-12-30T00:37">Dec 30, 2022</time></div><header class="c-card__header"><h2 class="c-card__title"><a href="https://d4nc1ntr33.funkysys.org/nginx-npm-geoip2/">Nginx NPM GeoIP2</a></h2><p>https://www.reddit.com/r/nginxproxymanager/comments/sjf1hw/tutorial_nginx_proxy_manager_together_with_geoip2/ now npm is shipped with nginx geoipmodules so just need to&hellip;</p></header></article></div></div></div></main><div class="right-bar"><div class="right-bar__inner"><div class="sidebar"><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><div><a href="https://d4nc1ntr33.funkysys.org/authors/dario/" class="authors__title">d4nc1ntr33</a> <span class="authors__meta">Post: 39</span></div></li></ul></section><section class="box tags"><h3 class="box__title">Recommended Topics</h3><ul class="tags__list"><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/android/" class="btn btn--gray">android <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/blamethedev/" class="btn btn--gray">blamethedev <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/crypto/" class="btn btn--gray">crypto <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/dkim/" class="btn btn--gray">dkim <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/dmarc/" class="btn btn--gray">dmarc <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/flask/" class="btn btn--gray">flask <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/flutter/" class="btn btn--gray">flutter <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/go/" class="btn btn--gray">go <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/lighthouse/" class="btn btn--gray">lighthouse <sup>(1)</sup></a></li><li class="tags__item"><a href="https://d4nc1ntr33.funkysys.org/tags/mariadb/" class="btn btn--gray">mariadb <sup>(1)</sup></a></li></ul></section><div class="box copyright">Powered by Funkysys.org</div></div></div></div></div><script defer="defer" src="https://d4nc1ntr33.funkysys.org/assets/js/scripts.min.js?v=12d8fcd46db8fdc7af6797ec26849875"></script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="7" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="https://d4nc1ntr33.funkysys.org/privacy-policy/">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        initialLsState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('ğŸª Config not found, or configuration expired');
            }

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                    'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                    'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                    'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                    'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                    'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                    'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                });  
                
                if (cbConfig.debugMode) {
                    console.log('ğŸª GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                        'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                        'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                        'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                        'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                        'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                        'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                    }));
                }
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('ğŸª Config founded');
            }

            cbConfig.initialLsState = currentConfig.split(',');

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                    'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                    'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                    'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                    'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                    'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                    'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                });
                
                if (cbConfig.debugMode) {
                    console.log('ğŸª GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                        'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                        'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                        'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                        'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                        'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                        'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                    }));
                }
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function getDefaultConsentState (currentConfig, consentGroup) {
        let configGroups = currentConfig.split(',');

        for (let i = 0; i < configGroups.length; i++) {
            let groupName = configGroups[i];
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === groupName);

            if (group && group[consentGroup]) {
                return 'granted';
            }
        }  
        
        if (window.publiiCBGCM.defaultState[consentGroup]) {
            return 'granted'; 
        }
        
        return 'denied';
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('ğŸª Allowed group: ' + allowedGroup);
        }

        if (window.publiiCBGCM && cbConfig.initialLsState.indexOf(allowedGroup) === -1) {
            let consentResult = {};
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === allowedGroup);

            if (group) {
                let foundSomeConsents = false;

                Object.keys(group).forEach(key => {
                    if (key !== 'cookieGroup' && group[key] === true) {
                        consentResult[key] = 'granted';
                        foundSomeConsents = true;
                    }
                });

                if (foundSomeConsents) {
                    gtag('consent', 'update', consentResult);   

                    if (cbConfig.debugMode) {
                        console.log('ğŸª GCMv2 UPDATE: ' + JSON.stringify(consentResult));
                    }
                }
            }
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('ğŸª Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('ğŸª Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('ğŸª State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('ğŸª Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('ğŸª Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('ğŸª Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('ğŸª Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('ğŸª Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupToCheck !== '' && groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('ğŸª Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('ğŸª Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>